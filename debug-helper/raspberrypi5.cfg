transport select swd
adapter speed 4000
reset_config srst_push_pull srst_only
set _CHIPNAME bcm2712
set _DAP_TAPID 0x4ba00477
set _CHIPCORES 4
swd newdap $_CHIPNAME cpu -expected-id $_DAP_TAPID
dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.cpu
set _DBGBASE {0x80010000 0x80110000 0x80210000 0x80310000}
set _CTIBASE {0x80020000 0x80120000 0x80220000 0x80320000}
for { set _core 0 } { $_core < $_CHIPCORES } { incr _core } {
    set _CTINAME $_CHIPNAME.cti$_core
    set _TARGETNAME $_CHIPNAME.cpu$_core
    cti create $_CTINAME -dap $_CHIPNAME.dap -ap-num 0 -baseaddr [lindex $_CTIBASE $_core]
    target create $_TARGETNAME aarch64 -dap $_CHIPNAME.dap -coreid $_core -dbgbase [lindex $_DBGBASE $_core] -cti $_CTINAME
    $_TARGETNAME configure -event gdb-attach { halt }
}
targets $_CHIPNAME.cpu0
init
$_CHIPNAME.cpu0 configure -event reset-init { halt }